
#驱动原理浅析#

###驱动在系统中作用###

驱动有很多类，但是最初的驱动肯定是为硬件而生。系统中大部分硬件都属于`I/O`设备，所以驱动基本可认为是`I/O`管理器负责管理了。

从前面知道，加载驱动时由`I/O`管理器创建驱动对象，并且调用驱动程序的入口函数`DriverEntry`。内核为用户层提供了统一的`I/O`接口，即`CreateFile`，`ReadFile`，`WriteFile`，`CloseHandle`等，`I/O`管理器使得来自用户模式的请求独立于设备，无论对端口的读写，键盘访问，磁盘操作等统一为`IRP`（`I/O` Request Package）的请求形式，其中IRP中包含了对设备的操作的数据，包括操作类型（读还是写），操作数据等。`I/O`请求由`I/O`管理器创建IRP后发起，IRP传到具体设备的驱动程序中，驱动程序负责“完成”这些IRP。

驱动程序完成IRP的几种处理方式如下：

1. 根据IRP请求，直接操作具体硬件，然后完成此IRP并返回。
2. 将此IRP请求转发到更底层的驱动程序中，并等待底层驱动的返回。
3. 接收到IRP请求后，不是马上完成IRP，而是分配新的IRP发到其他驱动程序中，并等待返回。

###驱动模型###



